---
import BaseLayout from "../../../app/layouts/base-layout.astro";
import FileCreateEdit from "../../../components/layout/file-create-edit.astro";
import HeadingBlock from "../../../components/layout/heading-block.astro";
import type { FileFromAPI } from "../../../shared/type/file-from-api";

export async function getStaticPaths() {
  const res = await fetch(`http://localhost:3000/notes`);
  const files = await res.json()
  return files.map((file: FileFromAPI) => ({
    params: { id: file.id },
  }));
}

const { id } = Astro.params;

const res = await fetch(`http://localhost:3000/notes/${id}`);
if (!res.ok) throw new Error(`Note not found: ${id}`);
const file = await res.json();
---

<BaseLayout title="Edit md">
  <div class="main">
    <HeadingBlock
      title="Edit the selected note"
      description="Edit, preview, save locally and upload the changes to the server"
    />
    <FileCreateEdit file={file}/>
  </div>
</BaseLayout>